import{createElement}from"react";var _extends=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r};function reactJSON(r){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r)return null;var t=r.type,n=r.props,i=r.children,o=e&&isComponent(t)?e[t]:t;return createElement(o,n,Array.isArray(i)?i.map(function(r){return reactJSON(r,e)}):i)}function isComponent(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/[A-Z]/.test(r[0])}function Node(r){var e=r.id,t=void 0===e?null:e,n=r.type,i=void 0===n?"div":n,o=r.props,d=void 0===o?{}:o,u=r.children,a=void 0===u?[]:u;return{id:t,parent:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,type:i,props:d,children:a}}function createStructure(){var r=null,e=0;function t(e){if(void 0===e)throw new Error("createStructure().get(id) requires an id to be provided");return r&&function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[e],o=void 0;for(;i.length;){o=i.shift();var d=t(o);if(n&&n(o))return d;if(o.children)for(var u=0;u<o.children.length;u++)i.push(o.children[u])}}(r,function(r){return r},function(r){return r.id===e})||!1}function n(r){return r&&void 0===r.id&&(r.id=e++),r}return{add:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(void 0===e)throw new Error("createStructure().add(data, parent) requires node data be provided");var o=Node(n(e));if(null===i||void 0===i)return r=o;var d=t(i);return d&&(o.parent=d.id,d.children.push(o)),o},get:t,update:function(r,e){if(void 0===r)throw new Error("createStructure().update(id, node) requires an id to be provided");if(void 0===e)throw new Error("createStructure().update(id, node) requires node data to update");for(var n=t(r),i=Object.keys(e),o=0;o<i.length;o++)n[i[o]]=e[i[o]];return n},remove:function(e){if(void 0===e)throw new Error("createStructure().remove(id) requires an id to be provided");var n=t(e);if(null===n.parent){var i=_extends({},r);return r=null,i}var o=t(n.parent);return o.children=o.children.filter(function(r){return r.id!==e}),_extends({},n)},build:function(e){if(void 0===e)throw new Error("createStructure().build(structure) requires a structure to be provided");var t=_extends({},e);return r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!1;return function r(e,o){var d=t(e,o);n&&n(e,o)&&(i=!0);var u=e.children&&e.children.length;if(u)for(var a=0;a<u&&!i;a++)r(e.children[a],e);return d}(e,null)}(Node(n(t)),function(r){if(Array.isArray(r.children)&&r.children.length)for(var e=0;e<r.children.length;e++){var t=r.children[e];r.children[e]=Node(n(t),r?r.id:null)}return r})},structure:function(){return r},destroy:function(){r=null,e=0}}}export default reactJSON;export{Node,createStructure};
